import unittest
import tempfile
import shutil
import os

TEST_DATA = "C:/Users/dmf/projects/invest/data/invest-test-data/coastal_vulnerability"
working_dir = "C:/Users/dmf/projects/invest_dev/coastal_vulnerability/test_workspace"


class CoastalVulnerabilityTests(unittest.TestCase):
    """Tests for the Coastal Vulnerability Model."""

    def setUp(self):
        """Overriding setUp function to create temp workspace directory."""
        # this lets us delete the workspace after its done no matter the
        # the rest result
        self.workspace_dir = tempfile.mkdtemp()

    def tearDown(self):
        """Overriding tearDown function to remove temporary directory."""
        shutil.rmtree(self.workspace_dir)


    def test_shore_points(self):
        from natcap.invest import coastal_vulnerability

        wwiii_vector_path = os.path.join(TEST_DATA, "WaveWatchIII_subset.shp")
        wwiii_rtree_path = os.path.join(working_dir, "wwiii_rtree.dat")
        landmass_vector_path = os.path.join(
            SAMPLE_DATA, "LandPolygon_WCVI.shp")
        target_shore_point_vector_path = os.path.join(
            working_dir, "shore_points.shp")

        coastal_vulnerability.build_wwiii_rtree(
            wwiii_vector_path, wwiii_rtree_path)

        coastal_vulnerability.create_shore_points(
            landmass_vector_path, wwiii_vector_path, wwiii_rtree_path,
            10000, working_dir, target_shore_point_vector_path)
